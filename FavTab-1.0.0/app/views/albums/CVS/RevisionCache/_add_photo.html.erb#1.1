<div class="grey_overlay" id="add_photo_popup">
  <div class="pop_up" >
    <div class="popup_inner_div">
      <a href="javascript:void(0);" onclick="jQuery('#add_photo_popup').hide();" class="popup_close_btn">&nbsp;</a>
      <div class="popup_content">
        <span class="popup_heading">Add Photo</span>
        <div id="add_ph_op_div">
          <a href="javascript:void(0);" class="add_photo_option" onclick="jQuery('#add_ph_op_div').hide();jQuery('#find_photo_form').show();" >Find Photo</a>
          <a href="javascript:void(0);" class="add_photo_option" >Upload Photo</a>
        </div>
        <div id="find_photo_form" class="photo_form">
          <%= form_for :photos, :url=>{:controller=>:albums, :action => 'find_photo'},:remote=>true do |f|  %>
            <table width="100%" class="popup_form_table">
              <tr>
                <td  align="left" width="30%"><span class="form_field_name">Site Url:<span class="mendatory">*</span></span></td>
                <td align="left" ><%= text_field 'photos','site_url', :style=>"width:200px" %><br/><span id="siteurlError" class="form_error"></span></td>
              </tr>
              <tr>
                <td></td>
                <td><input id="find_photo_btn" type="submit" class="blue_btn" value="Find" onclick="return check_photo_url('none');" /></td>
              </tr>
            </table>
          <% end %>
        </div>
        <div id="upload_photo_form" class="photo_form">
          <%#= form_for :site, :url=>{:controller=>:albums, :action => 'add_photo'}, :html=>{:onsubmit=>"return check_photo_url();"} do |f|  %>
            <table width="100%" class="popup_form_table">
              <tr>
                <td  align="left" width="30%"><span class="form_field_name">Site Url:<span class="mendatory">*</span></span></td>
                <td align="left" ><%= file_field :photos, :image, :class=>"required",:style=>"height:21px;width:200px;font-size:10px;"%><br/><span id="siteurlError" class="form_error"></span></td>
              </tr>
              <tr>
                <td><%#= hidden_field 'site','tab_id' %><%#= hidden_field 'site','id'%></td>
                <td><input type="submit" class="blue_btn" value="Upload"/></td>
              </tr>
            </table>
          <%# end %>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  jQuery(document).ready(function(){
    jQuery("#add_photo_popup .pop_up").css({"position":"fixed","top":(jQuery(window).height()-jQuery("#add_photo_popup .pop_up").height())/2+"px"});
    jQuery("#add_photo_popup .pop_up").css({"position":"fixed","left":(jQuery(window).width()-jQuery("#add_photo_popup .pop_up").width())/2+"px"});
  });

  function check_photo_url(mode)
  {
    var url ="";
    if(mode=="prev")
    {
      url= jQuery("#site_url_prev").val();
    }
    else
    {
      url= jQuery("#photos_site_url").val();
    }
       
    var flag = true;
    var tabRegExp = /^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/;
    if(jQuery.trim(url).length==0)
    {
      flag = false;
    }
    else
    {
      if(!url.match(tabRegExp))
      {
        flag = false;
      }
    }
    if(flag)
    {

      url = encodeURIComponent(url);
      jQuery.get("<%= url_for :action => 'find_photo',:only_path => false %>?site_url="+url,function(data){
          //alert(data);
          $rem_html = jQuery(data);
          var is_found = false;
          jQuery("#add_photo_popup").fadeOut(function(){
            $images= jQuery("<div class='rem_ph_div'></div>");
            $rem_html.find("img").each(function(v,i){
              //jQuery(this).removeAttr("width");
              //jQuery(this).removeAttr("height");
              //jQuery(this).css({'width':'auto','height':'auto'});
              console.log(jQuery(this).width());
              if(jQuery(this).width()>180 || jQuery(this).height()>180)
              {
                
                $images.append(jQuery(this));
                is_found = true;
              }
              
            });
            if(is_found)
            {
              jQuery("#show_remote_photos div.rem_ph_div").replaceWith($images);
              jQuery("#show_remote_photos div.rem_ph_div img:first").addClass("current");
              jQuery("#photo_url_field").val(jQuery("#show_remote_photos div.rem_ph_div img:first").attr('src'));
              jQuery("#show_remote_photos").fadeIn();
            }
            else
            {
              alert("No usefull image found.")
            }
          });
      });
    }
    return false;
  }
 
</script>